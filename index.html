<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Pro V1</title>
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="manifest" href="manifest.json">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7c3aed', // Violet-600
                        primaryLight: '#ede9fe', // Violet-100
                        primaryDark: '#5b21b6', // Violet-800
                        accent: '#db2777', // Pink-600 for contrast
                    },
                    animation: {
                        'scaleIn': 'scaleIn 0.2s ease-out',
                    },
                    keyframes: {
                        scaleIn: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input:focus, select:focus, textarea:focus { outline: 2px solid #7c3aed; outline-offset: 1px; }
        /* Fix for iPhone safe areas */
        .safe-area-pb { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICONS ---
        const Icon = ({ d, className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={d} /></svg>;
        const Icons = {
            Cart: () => <Icon d="M9 20a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm7 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-7-4h7a2 2 0 0 0 2-1.7l1.3-9.3H6.4M5 4H2" className="w-5 h-5" />,
            Box: () => <Icon d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" className="w-5 h-5" />,
            Book: () => <Icon d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" className="w-5 h-5" />, 
            Chart: () => <Icon d="M18 20V10M12 20V4M6 20v-6" className="w-5 h-5" />,
            Plus: () => <Icon d="M12 5v14M5 12h14" className="w-5 h-5" />,
            Minus: () => <Icon d="M5 12h14" className="w-5 h-5" />,
            Trash: () => <Icon d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" className="w-5 h-5" />,
            Check: () => <Icon d="M20 6L9 17l-5-5" className="w-5 h-5" />,
            Search: () => <Icon d="M21 21l-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z" className="w-5 h-5" />,
            User: () => <Icon d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" className="w-5 h-5" />,
            Refresh: () => <Icon d="M23 4v6h-6M1 20v-6h6" className="w-4 h-4" />
        };

        // --- DATA HELPERS ---
        const DATA_KEY = 'grocery_app_v1';
        const loadData = () => {
            try { return JSON.parse(localStorage.getItem(DATA_KEY)) || { inventory: [], transactions: [] }; } 
            catch (e) { return { inventory: [], transactions: [] }; }
        };
        const saveData = (data) => localStorage.setItem(DATA_KEY, JSON.stringify(data));

        // --- APP COMPONENT ---
        function App() {
            const [data, setData] = useState(loadData);
            const [activeTab, setActiveTab] = useState('pos'); // pos, inventory, debts, stats
            const [cart, setCart] = useState([]);

            useEffect(() => { saveData(data); }, [data]);

            // --- ACTIONS ---
            const addToCart = (item) => {
                setCart(prev => {
                    const existing = prev.find(i => i.id === item.id);
                    if (existing) return prev.map(i => i.id === item.id ? { ...i, qty: i.qty + 1 } : i);
                    return [...prev, { ...item, qty: 1 }];
                });
            };
            const removeFromCart = (itemId) => setCart(prev => prev.filter(i => i.id !== itemId));
            const updateCartQty = (itemId, delta) => {
                setCart(prev => prev.map(i => {
                    if (i.id === itemId) return { ...i, qty: Math.max(1, i.qty + delta) };
                    return i;
                }));
            };

            const handleCheckout = (paymentMethod, contactName) => {
                if (cart.length === 0) return;
                const totalAmount = cart.reduce((sum, item) => sum + (item.sellPrice * item.qty), 0);
                const totalProfit = cart.reduce((sum, item) => sum + ((item.sellPrice - item.buyPrice) * item.qty), 0);
                const newTransaction = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    type: 'sale', // sale or purchase
                    items: cart,
                    total: totalAmount,
                    profit: totalProfit,
                    contact: contactName || 'Walk-in Customer',
                    status: paymentMethod === 'credit' ? 'unpaid' : 'paid'
                };
                const newInventory = data.inventory.map(item => {
                    const cartItem = cart.find(c => c.id === item.id);
                    if (cartItem) return { ...item, stock: item.stock - cartItem.qty };
                    return item;
                });
                setData(prev => ({ inventory: newInventory, transactions: [newTransaction, ...prev.transactions] }));
                setCart([]);
                alert('Sale Recorded!');
            };

            const handleAddProduct = (newItem) => {
                setData(prev => ({ ...prev, inventory: [...prev.inventory, { ...newItem, id: Date.now(), stock: 0 }] }));
            };

            const handleRestock = (itemId, qty, cost, supplier, isCredit) => {
                const newTransaction = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    type: 'purchase',
                    items: [{ id: itemId, qty: qty, cost: cost }],
                    total: cost,
                    contact: supplier || 'Unknown Supplier',
                    status: isCredit ? 'unpaid' : 'paid'
                };
                const newInventory = data.inventory.map(item => 
                    item.id === itemId ? { ...item, stock: parseInt(item.stock) + parseInt(qty), buyPrice: (cost/qty).toFixed(0) } : item
                );
                setData(prev => ({ inventory: newInventory, transactions: [newTransaction, ...prev.transactions] }));
            };

            const handleSettleDebt = (transId) => {
                if(!confirm("Mark this debt as fully paid?")) return;
                setData(prev => ({ ...prev, transactions: prev.transactions.map(t => t.id === transId ? { ...t, status: 'paid' } : t) }));
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-gray-50 pb-24 text-slate-800">
                    {/* Header */}
                    <div className="bg-primary text-white p-4 sticky top-0 z-40 shadow-md flex justify-between items-center">
                        <h1 className="text-xl font-bold tracking-tight">Grocery Pro</h1>
                        <div className="text-xs font-medium bg-white/20 px-2 py-1 rounded">V1.1</div>
                    </div>

                    {/* Main Content Area */}
                    <div className="p-4">
                        {activeTab === 'pos' && <PosTab inventory={data.inventory} cart={cart} onAdd={addToCart} onRemove={removeFromCart} onUpdateQty={updateCartQty} onCheckout={handleCheckout} />}
                        {activeTab === 'inventory' && <InventoryTab inventory={data.inventory} onAddProduct={handleAddProduct} onRestock={handleRestock} onDelete={(id) => setData(p => ({...p, inventory: p.inventory.filter(i=>i.id!==id)}))} />}
                        {activeTab === 'debts' && <DebtTab transactions={data.transactions} onSettle={handleSettleDebt} />}
                        {activeTab === 'stats' && <StatsTab transactions={data.transactions} inventory={data.inventory} />}
                    </div>

                    {/* Bottom Navigation */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around py-2 pb-safe safe-area-pb z-30 max-w-md mx-auto shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                        <NavBtn id="pos" icon={<Icons.Cart />} label="·Ä°·Äõ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏" active={activeTab} set={setActiveTab} />
                        <NavBtn id="inventory" icon={<Icons.Box />} label="·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏" active={activeTab} set={setActiveTab} />
                        <NavBtn id="debts" icon={<Icons.Book />} label="·Ä°·ÄÄ·Äº·ÄΩ·Ä±·Ä∏" active={activeTab} set={setActiveTab} />
                        <NavBtn id="stats" icon={<Icons.Chart />} label="·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏" active={activeTab} set={setActiveTab} />
                    </div>
                </div>
            );
        }

        // --- SUB COMPONENTS ---
        const NavBtn = ({ id, icon, label, active, set }) => (
            <button onClick={() => set(id)} className={`flex flex-col items-center gap-1 w-16 transition-colors ${active === id ? 'text-primary' : 'text-gray-400'}`}>
                <div className={`transition-all ${active === id ? 'bg-primaryLight p-1 rounded-xl -translate-y-1' : ''}`}>{icon}</div>
                <span className="text-[10px] font-bold">{label}</span>
            </button>
        );

        // 1. POS TAB (FIXED Z-INDEX & PADDING)
        function PosTab({ inventory, cart, onAdd, onRemove, onUpdateQty, onCheckout }) {
            const [search, setSearch] = useState('');
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [checkoutStep, setCheckoutStep] = useState('cart'); 
            const [customerName, setCustomerName] = useState('');

            const filteredItems = inventory.filter(i => i.name.toLowerCase().includes(search.toLowerCase()));
            const cartTotal = cart.reduce((sum, item) => sum + (item.sellPrice * item.qty), 0);
            const cartCount = cart.reduce((sum, item) => sum + item.qty, 0);

            return (
                <div>
                    <div className="relative mb-4">
                        <span className="absolute left-3 top-3 text-gray-400"><Icons.Search /></span>
                        <input type="text" placeholder="·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äõ·Äæ·Ä¨·Äõ·Äî·Ä∫..." className="w-full pl-10 pr-4 py-3 rounded-xl border-none shadow-sm bg-white" value={search} onChange={e => setSearch(e.target.value)} />
                    </div>

                    <div className="grid grid-cols-2 gap-3 pb-24"> 
                        {filteredItems.map(item => (
                            <div key={item.id} onClick={() => onAdd(item)} className="bg-white p-3 rounded-xl shadow-sm border border-transparent hover:border-primary transition-all active:scale-95">
                                <div className="flex justify-between items-start mb-2">
                                    <div className="h-10 w-10 bg-violet-100 rounded-lg flex items-center justify-center text-primary font-bold text-lg">{item.name.charAt(0)}</div>
                                    <span className={`text-xs font-bold px-2 py-1 rounded-full ${item.stock > 5 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{item.stock}</span>
                                </div>
                                <h3 className="font-bold text-gray-800 truncate">{item.name}</h3>
                                <p className="text-primary font-bold">{item.sellPrice} Ks</p>
                            </div>
                        ))}
                        {filteredItems.length === 0 && <div className="col-span-2 text-center text-gray-400 py-10">·Äï·ÄÖ·Äπ·ÄÖ·Ää·Ä∫·Ä∏·Äô·Äõ·Äæ·Ä≠·Äï·Ä´ (Inventory ·Äê·ÄΩ·ÄÑ·Ä∫·Äë·Ää·Ä∑·Ä∫·Äï·Ä´)</div>}
                    </div>

                    {cart.length > 0 && (
                        <button onClick={() => { setIsCartOpen(true); setCheckoutStep('cart'); }} className="fixed bottom-24 right-4 bg-primary text-white px-6 py-3 rounded-full shadow-lg flex items-center gap-3 animate-bounce z-20">
                            <span className="bg-white text-primary text-xs font-bold h-6 w-6 rounded-full flex items-center justify-center">{cartCount}</span>
                            <span className="font-bold">Total: {cartTotal} Ks</span>
                        </button>
                    )}

                    {isCartOpen && (
                        <div className="fixed inset-0 bg-black/60 z-[100] flex items-end sm:items-center justify-center">
                            <div className="bg-white w-full max-w-md h-[85vh] sm:h-auto sm:rounded-2xl rounded-t-2xl flex flex-col shadow-2xl">
                                <div className="p-4 border-b flex justify-between items-center bg-gray-50 rounded-t-2xl">
                                    <h2 className="font-bold text-lg">{checkoutStep === 'cart' ? 'Current Order' : 'Payment Info'}</h2>
                                    <button onClick={() => setIsCartOpen(false)} className="text-gray-400 p-2 hover:text-red-500"><Icons.Trash /></button>
                                </div>

                                <div className="flex-1 overflow-y-auto p-4">
                                    {checkoutStep === 'cart' ? (
                                        <div className="space-y-4">
                                            {cart.map(item => (
                                                <div key={item.id} className="flex justify-between items-center">
                                                    <div>
                                                        <h4 className="font-bold text-gray-800">{item.name}</h4>
                                                        <p className="text-xs text-gray-500">{item.sellPrice} Ks x {item.qty}</p>
                                                    </div>
                                                    <div className="flex items-center gap-3">
                                                        <button onClick={() => onUpdateQty(item.id, -1)} className="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-600"><Icons.Minus /></button>
                                                        <span className="font-bold w-4 text-center">{item.qty}</span>
                                                        <button onClick={() => onUpdateQty(item.id, 1)} className="w-8 h-8 bg-primaryLight text-primary rounded-full flex items-center justify-center"><Icons.Plus /></button>
                                                    </div>
                                                </div>
                                            ))}
                                            <div className="border-t pt-4 mt-4">
                                                <div className="flex justify-between text-xl font-bold"><span>Total</span><span>{cartTotal} Ks</span></div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-bold text-gray-500 mb-1">Customer Name (Optional)</label>
                                                <input type="text" value={customerName} onChange={e => setCustomerName(e.target.value)} className="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white transition-colors" placeholder="Enter name..." />
                                            </div>
                                            <div className="bg-yellow-50 p-3 rounded-lg border border-yellow-200 text-sm text-yellow-800">
                                                <strong>·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫:</strong> ·Ä°·ÄÄ·Äº·ÄΩ·Ä±·Ä∏·Äõ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äô·Ää·Ä∫·ÄÜ·Ä≠·ÄØ·Äï·Ä´·ÄÄ ·Äî·Ä¨·Äô·Ää·Ä∫ ·Äô·Äñ·Äº·ÄÖ·Ä∫·Äô·Äî·Ä± ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´·Åã
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div className="p-4 border-t bg-white pb-8">
                                    {checkoutStep === 'cart' ? (
                                        <button onClick={() => setCheckoutStep('payment')} className="w-full bg-primary text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-violet-200">Proceed to Pay</button>
                                    ) : (
                                        <div className="grid grid-cols-2 gap-3">
                                            <button onClick={() => { onCheckout('cash', customerName); setIsCartOpen(false); }} className="bg-green-600 text-white py-3 rounded-xl font-bold flex flex-col items-center shadow-lg shadow-green-100"><span>Cash (·Äú·ÄÄ·Ä∫·ÄÑ·ÄÑ·Ä∫·Ä∏)</span><span className="text-[10px] font-normal opacity-80">Paid Now</span></button>
                                            <button onClick={() => { if(!customerName) return alert('·Äî·Ä¨·Äô·Ää·Ä∫·Äë·Ää·Ä∑·Ä∫·Äï·Ä´'); onCheckout('credit', customerName); setIsCartOpen(false); }} className="bg-red-500 text-white py-3 rounded-xl font-bold flex flex-col items-center shadow-lg shadow-red-100"><span>Credit (·Ä°·ÄÄ·Äº·ÄΩ·Ä±·Ä∏)</span><span className="text-[10px] font-normal opacity-80">Pay Later</span></button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // 2. INVENTORY TAB
        function InventoryTab({ inventory, onAddProduct, onRestock, onDelete }) {
            const [isAddOpen, setIsAddOpen] = useState(false);
            const [restockItem, setRestockItem] = useState(null); 
            const [newItem, setNewItem] = useState({ name: '', buyPrice: '', sellPrice: '' });
            const [restockData, setRestockData] = useState({ qty: '', totalCost: '', supplier: '', isCredit: false });

            const handleRestockSubmit = () => {
                if(!restockData.qty || !restockData.totalCost) return alert('Need Qty & Cost');
                onRestock(restockItem.id, restockData.qty, restockData.totalCost, restockData.supplier, restockData.isCredit);
                setRestockItem(null); setRestockData({ qty: '', totalCost: '', supplier: '', isCredit: false });
            };

            return (
                <div>
                    <button onClick={() => setIsAddOpen(true)} className="w-full bg-primaryLight text-primary border-2 border-dashed border-primary p-4 rounded-xl font-bold flex items-center justify-center gap-2 mb-4"><Icons.Plus /> Add New Item</button>
                    <div className="space-y-3 pb-20">
                        {inventory.map(item => (
                            <div key={item.id} className="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center">
                                <div>
                                    <h3 className="font-bold text-gray-800">{item.name}</h3>
                                    <div className="text-xs text-gray-500 mt-1 space-x-2"><span className="bg-gray-100 px-2 py-0.5 rounded">Stock: <b>{item.stock}</b></span><span>Buy: {item.buyPrice}</span><span className="text-green-600 font-bold">Sell: {item.sellPrice}</span></div>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => setRestockItem(item)} className="p-2 bg-blue-50 text-blue-600 rounded-lg text-xs font-bold flex flex-col items-center"><Icons.Refresh /> Stock</button>
                                    <button onClick={() => confirm('Delete?') && onDelete(item.id)} className="p-2 text-gray-300 hover:text-red-500"><Icons.Trash /></button>
                                </div>
                            </div>
                        ))}
                    </div>

                    {isAddOpen && (
                        <Modal title="New Product" onClose={() => setIsAddOpen(false)}>
                            <div className="space-y-3">
                                <input className="w-full p-3 border rounded-xl" placeholder="Product Name" value={newItem.name} onChange={e => setNewItem({...newItem, name: e.target.value})} />
                                <div className="grid grid-cols-2 gap-3">
                                    <input type="number" className="w-full p-3 border rounded-xl" placeholder="Buy Price" value={newItem.buyPrice} onChange={e => setNewItem({...newItem, buyPrice: e.target.value})} />
                                    <input type="number" className="w-full p-3 border rounded-xl" placeholder="Sell Price" value={newItem.sellPrice} onChange={e => setNewItem({...newItem, sellPrice: e.target.value})} />
                                </div>
                                <button onClick={() => { if(newItem.name) { onAddProduct(newItem); setIsAddOpen(false); setNewItem({name:'',buyPrice:'',sellPrice:''}); }}} className="w-full bg-primary text-white py-3 rounded-xl font-bold mt-2">Save Item</button>
                            </div>
                        </Modal>
                    )}

                    {restockItem && (
                        <Modal title={`Restock: ${restockItem.name}`} onClose={() => setRestockItem(null)}>
                            <div className="space-y-3">
                                <div className="grid grid-cols-2 gap-3">
                                    <div><label className="text-xs font-bold text-gray-500">Qty to Add</label><input type="number" className="w-full p-3 border rounded-xl" placeholder="0" value={restockData.qty} onChange={e => setRestockData({...restockData, qty: e.target.value})} /></div>
                                    <div><label className="text-xs font-bold text-gray-500">Total Cost (Ks)</label><input type="number" className="w-full p-3 border rounded-xl" placeholder="0" value={restockData.totalCost} onChange={e => setRestockData({...restockData, totalCost: e.target.value})} /></div>
                                </div>
                                <div><label className="text-xs font-bold text-gray-500">Supplier Name</label><input className="w-full p-3 border rounded-xl" placeholder="e.g. Daw Mya" value={restockData.supplier} onChange={e => setRestockData({...restockData, supplier: e.target.value})} /></div>
                                <div className="flex items-center gap-3 p-3 bg-gray-50 rounded-xl"><input type="checkbox" id="credit" className="w-5 h-5 accent-primary" checked={restockData.isCredit} onChange={e => setRestockData({...restockData, isCredit: e.target.checked})} /><label htmlFor="credit" className="text-sm font-bold text-gray-700">Suppler Credit (·Äí·Ä≠·ÄØ·ÄÑ·Ä∫·Ä°·ÄÄ·Äº·ÄΩ·Ä±·Ä∏·Äú·Ä¨·Ä∏?)</label></div>
                                <button onClick={handleRestockSubmit} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold mt-2">Confirm Restock</button>
                            </div>
                        </Modal>
                    )}
                </div>
            );
        }

        // 3. DEBTS TAB
        function DebtTab({ transactions, onSettle }) {
            const [view, setView] = useState('receivable'); // receivable (customer), payable (supplier)
            const debts = transactions.filter(t => t.status === 'unpaid');
            const receivables = debts.filter(t => t.type === 'sale');
            const payables = debts.filter(t => t.type === 'purchase');
            const currentList = view === 'receivable' ? receivables : payables;

            return (
                <div className="pb-20">
                    <div className="flex p-1 bg-white rounded-xl mb-4 shadow-sm">
                        <button onClick={() => setView('receivable')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${view === 'receivable' ? 'bg-green-100 text-green-700 shadow-sm' : 'text-gray-400'}`}>·Äõ·Äõ·Äî·Ä∫·Äõ·Äæ·Ä≠ (Customer)</button>
                        <button onClick={() => setView('payable')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${view === 'payable' ? 'bg-red-100 text-red-700 shadow-sm' : 'text-gray-400'}`}>·Äï·Ä±·Ä∏·Äõ·Äî·Ä∫·Äõ·Äæ·Ä≠ (Supplier)</button>
                    </div>

                    <div className="space-y-3">
                        {currentList.map(t => (
                            <div key={t.id} className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-transparent" style={{borderLeftColor: view === 'receivable' ? '#16a34a' : '#dc2626'}}>
                                <div className="flex justify-between items-start">
                                    <div><h3 className="font-bold text-gray-800">{t.contact}</h3><p className="text-xs text-gray-400">{new Date(t.date).toLocaleDateString()}</p></div>
                                    <span className={`font-bold ${view==='receivable'?'text-green-600':'text-red-600'}`}>{t.total} Ks</span>
                                </div>
                                <div className="mt-3 flex justify-end">
                                    <button onClick={() => onSettle(t.id)} className="px-4 py-2 bg-gray-800 text-white text-xs font-bold rounded-lg shadow-sm active:scale-95">{view === 'receivable' ? 'Received (·Äõ·Äï·Äº·ÄÆ)' : 'Paid (·Äï·Ä±·Ä∏·Äï·Äº·ÄÆ·Ä∏)'}</button>
                                </div>
                            </div>
                        ))}
                        {currentList.length === 0 && <div className="text-center text-gray-400 py-10">No Debts Found üéâ</div>}
                    </div>
                </div>
            );
        }

        // 4. STATS TAB (WITH BACKUP)
        function StatsTab({ transactions, inventory }) {
            const today = new Date().toISOString().split('T')[0];
            const sales = transactions.filter(t => t.type === 'sale');
            const todaySales = sales.filter(t => t.date.startsWith(today));
            const totalSales = sales.reduce((acc, t) => acc + t.total, 0);
            const todayTotalSales = todaySales.reduce((acc, t) => acc + t.total, 0);
            const totalProfit = sales.reduce((acc, t) => acc + (t.profit || 0), 0);
            const todayProfit = todaySales.reduce((acc, t) => acc + (t.profit || 0), 0);
            const stockValue = inventory.reduce((acc, i) => acc + (i.stock * i.buyPrice), 0);

            const handleBackup = () => {
                const dataStr = JSON.stringify(localStorage.getItem('grocery_app_v1'));
                const blob = new Blob([JSON.parse(dataStr)], {type: "application/json"});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `grocery_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleRestore = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const content = JSON.parse(e.target.result);
                        if (content.inventory && content.transactions) {
                            if(confirm("Warning: ·Äú·ÄÄ·Ä∫·Äõ·Äæ·Ä≠·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏ ·Äï·Äª·ÄÄ·Ä∫·Äï·Äº·ÄÆ·Ä∏ Backup ·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Ä°·ÄÖ·Ä¨·Ä∏·Äë·Ä≠·ÄØ·Ä∏·Äï·Ä´·Äô·Ää·Ä∫·Åã ·Äú·ÄØ·Äï·Ä∫·Äô·Äú·Ä¨·Ä∏?")) {
                                localStorage.setItem('grocery_app_v1', JSON.stringify(content));
                                alert("Data Restored! App ·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Äî·Ä∫·ÄÖ·Äï·Ä´·Äô·Ää·Ä∫·Åã");
                                window.location.reload();
                            }
                        } else { alert("·Äô·Äæ·Ä¨·Ä∏·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äû·Ä±·Ä¨ ·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫·Äñ·Äº·ÄÖ·Ä∫·Äî·Ä±·Äû·Ää·Ä∫·Åã (Invalid Backup File)"); }
                    } catch (err) { alert("Error restoring data."); }
                };
                reader.readAsText(file);
            };

            return (
                <div className="space-y-4 pb-20">
                    <div className="bg-primary text-white p-5 rounded-2xl shadow-lg shadow-violet-200">
                        <h2 className="text-sm font-medium opacity-80 mb-1">Today's Net Profit (·Ä°·Äû·Ä¨·Ä∏·Äê·ÄÑ·Ä∫·Ä°·Äô·Äº·Äê·Ä∫)</h2>
                        <div className="text-4xl font-bold">{todayProfit} <span className="text-lg font-normal">Ks</span></div>
                        <div className="mt-4 pt-4 border-t border-white/20 flex justify-between">
                            <div><div className="text-xs opacity-70">Today Sales</div><div className="font-bold">{todayTotalSales} Ks</div></div>
                            <div className="text-right"><div className="text-xs opacity-70">All Time Sales</div><div className="font-bold">{totalSales} Ks</div></div>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <StatCard title="Stock Value" value={stockValue} icon={<Icons.Box />} color="bg-blue-100 text-blue-700" />
                        <StatCard title="Total Profit" value={totalProfit} icon={<Icons.Chart />} color="bg-green-100 text-green-700" />
                    </div>

                    <div className="mt-8 pt-6 border-t border-gray-200">
                        <h3 className="font-bold text-gray-700 mb-3">Data Management (·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫ ·Äë·Ä≠·Äî·Ä∫·Ä∏·Äû·Ä≠·Äô·Ä∫·Ä∏·Äõ·Äî·Ä∫)</h3>
                        <div className="grid grid-cols-2 gap-3">
                            <button onClick={handleBackup} className="bg-gray-800 text-white p-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 active:scale-95 transition-transform"><Icons.Check /> Download Backup</button>
                            <label className="bg-white border border-gray-300 text-gray-700 p-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 cursor-pointer active:scale-95 transition-transform"><Icons.Refresh /> Restore Data<input type="file" accept=".json" onChange={handleRestore} className="hidden" /></label>
                        </div>
                        <p className="text-[10px] text-gray-400 mt-2 text-center">·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äï·Äª·Ä±·Ä¨·ÄÄ·Ä∫·Äú·Äª·Äæ·ÄÑ·Ä∫ Data ·Äô·Äï·Äª·Ä±·Ä¨·ÄÄ·Ä∫·ÄÖ·Ä±·Äõ·Äî·Ä∫ "Download Backup" ·ÄÄ·Ä≠·ÄØ ·Äô·ÄÄ·Äº·Ä¨·ÄÅ·Äè ·Äî·Äæ·Ä≠·Äï·Ä∫·Åç ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äë·Ä¨·Ä∏·Äï·Ä´·Åã</p>
                    </div>
                </div>
            );
        }

        const StatCard = ({ title, value, icon, color }) => (
            <div className="bg-white p-4 rounded-xl shadow-sm flex flex-col justify-between h-24">
                <div className="flex justify-between items-start"><span className="text-xs font-bold text-gray-500">{title}</span><div className={`p-1.5 rounded-lg ${color}`}>{icon}</div></div>
                <span className="font-bold text-lg text-gray-800">{value}</span>
            </div>
        );

        const Modal = ({ title, children, onClose }) => (
            <div className="fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4">
                <div className="bg-white w-full max-w-xs rounded-2xl shadow-2xl animate-scaleIn">
                    <div className="p-4 border-b flex justify-between items-center"><h3 className="font-bold">{title}</h3><button onClick={onClose}><Icons.Trash className="w-5 h-5 text-gray-400 rotate-45" /></button></div>
                    <div className="p-4">{children}</div>
                </div>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
